<div class="container mx-auto p-4">
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <mat-spinner></mat-spinner>
  </div>

  <mat-card *ngIf="!isLoading" class="max-w-lg mx-auto">
    <mat-card-header class="!flex-row justify-center">
      <mat-card-title>User Profile</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="flex justify-center my-4">
        <div class="avatar">
          <div class="w-24 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
            <img [src]="user()?.photoURL || 'assets/placeholder.jpg'" />
          </div>
        </div>
      </div>
      <div class="flex justify-center my-4">
        <input
          type="file"
          (change)="onFileSelected($event)"
          class="file-input file-input-bordered w-full max-w-xs"
        />
      </div>
      <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="flex flex-col gap-4">
        <mat-form-field>
          <mat-label>Display Name</mat-label>
          <input matInput formControlName="displayName" placeholder="Enter your display name" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" readonly />
        </mat-form-field>
        <div
          *ngIf="user() && !user()?.emailVerified"
          class="p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700"
        >
          <p>
            Your email is not verified.
            <button (click)="sendVerificationEmail()" class="link link-primary">
              Send verification email
            </button>
          </p>
        </div>
      </form>
    </mat-card-content>
    <mat-card-actions class="!flex-row justify-end p-4">
      <button
        type="submit"
        (click)="updateProfile()"
        class="btn btn-primary"
        [disabled]="profileForm.invalid && !selectedFile"
      >
        Update Profile
      </button>
    </mat-card-actions>
  </mat-card>
</div>
